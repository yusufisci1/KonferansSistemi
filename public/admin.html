<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <div class="button-container">
     <!-- ğŸ“Œ SaÄŸ Ãœst KÃ¶ÅŸede AÃ§Ä±lÄ±r Ayarlar MenÃ¼sÃ¼ -->
     <div class="dropdown">
        <button class="settings-button" onclick="toggleDropdown()">âš™</button>
        <div class="dropdown-menu" id="dropdownMenu">
            <a href="userdelete.html"> KullanÄ±cÄ±larÄ± GÃ¶rÃ¼ntÃ¼le</a>
            <a href="settings.html"> KullanÄ±cÄ± Ekle</a>
            <a href="reports.html"> Raporlar</a>
            <a href="lists.html"> Oylama ve YoklamalarÄ± listele</a>
        </div>
    </div>
    </div> <title>BaÅŸkan Paneli</title>
    <!-- CSS dosyasÄ±nÄ± baÄŸladÄ±k -->
    <link href="styleadmin.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"></script>
</head>
<body>
    <button class="logout-button" onclick="logout()">X</button>
    <h1>BaÅŸkan Paneli</h1>

    <div class="container">
        <!-- SÃ¶z Ä°stekleri -->
        <div class="section">
            <div style="display: inline-block; margin-left: 20px;"> 
                <button onclick="startMeeting()">ToplantÄ±yÄ± BaÅŸlat</button>
                <button onclick="endMeeting()">ToplantÄ±yÄ± Bitir</button> 
                <p id="meetingStatus">ToplantÄ± baÅŸlamadÄ±.</p>
            </div>
            <h2>SÃ¶z Ä°stekleri</h2>
            <div id="requests" class="request">
                <!-- Dinamik olarak buraya veriler eklenecek -->
            </div>
        </div>

        <!-- Oylama SonuÃ§larÄ± -->
        <div class="section">
            <div style="display: inline-block; margin-left: 20px;">
                <button onclick="startVoting()">OylamayÄ± BaÅŸlat</button>
                <button onclick="endVoting()">OylamayÄ± Bitir</button> <!-- Yeni buton -->
                <p id="votingStatus">Oylama baÅŸlamadÄ±.</p>
            </div>
            <h2>Oylama SonuÃ§larÄ±</h2>
            <div id="votes" class="vote">
                <!-- Dinamik olarak buraya veriler eklenecek -->
            </div>

            <div id="voteCounts" style="margin-top: 20px; display: flex; gap: 20px; justify-content: center;">
                <p>Kabul: <span id="acceptCount">0</span></p>
                <p>Red: <span id="rejectCount">0</span></p>
            </div>
        </div>

        <!-- Yoklamaya KatÄ±lanlar -->
        <div class="section">
            <div style="display: inline-block; margin-left: 20px;">
                <button onclick="startAttendance()">YoklamayÄ± BaÅŸlat</button>
                <button onclick="endAttendance()">YoklamayÄ± Bitir</button> <!-- Yeni buton -->
                <p id="attendanceStatus">Yoklama baÅŸlamadÄ±.</p>
            </div>
            <h2>Yoklamaya KatÄ±lanlar</h2>
            <div id="attendees" class="attendance">
                <!-- Dinamik olarak buraya veriler eklenecek -->
            </div>
            <div id="attendanceCounts" style="margin-top: 20px;">
                <p>KatÄ±lÄ±mcÄ± SayÄ±sÄ±: <span id="attendanceCount">0</span></p>
            </div>

        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        function toggleDropdown() {
            document.getElementById("dropdownMenu").classList.toggle("show");
        }

        // ğŸ“Œ SayfanÄ±n baÅŸka bir yerine tÄ±klanÄ±nca menÃ¼yÃ¼ kapatma
        window.onclick = function(event) {
            if (!event.target.matches('.settings-button')) {
                var dropdowns = document.getElementsByClassName("dropdown-menu");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains("show")) {
                        openDropdown.classList.remove("show");
                    }
                }
            }
        }



        function goToSettings() {
            window.location.href = "settings.html"; // Ayarlar sayfasÄ±na yÃ¶nlendir
        }

        function goToReports() {
            window.location.href = "reports.html"; // Raporlar sayfasÄ±na yÃ¶nlendirme
        }

        function startMeeting() {
            console.log("ToplantÄ±yÄ± baÅŸlat butonuna tÄ±klandÄ±.");
            socket.emit("startMeeting");
        }
        function endMeeting() {
            socket.emit("endMeeting"); // Sunucuya toplantÄ±yÄ± bitirme isteÄŸi gÃ¶nder
        }
    
        function startVoting() {
            console.log("OylamayÄ± baÅŸlat butonuna tÄ±klandÄ±.");
            socket.emit("startVoting");
        }
    
        function startAttendance() {
            console.log("YoklamayÄ± baÅŸlat butonuna tÄ±klandÄ±.");
            socket.emit("startAttendance");
        }
        function endVoting() {
            socket.emit("endVoting"); // Sunucuya oylamayÄ± bitirme isteÄŸi gÃ¶nder
        }
        function endAttendance() {
            socket.emit("endAttendance"); // Sunucuya yoklamayÄ± bitirme isteÄŸi gÃ¶nder
        }

        function approveRequest(button, username) {
            socket.emit("approveRequest", username);
        
            // Butonun bulunduÄŸu Ã¶ÄŸeyi sil
            const item = button.parentElement;
            item.remove();
        }
    
        socket.on("meetingStarted", () => {
            console.log("ToplantÄ± baÅŸlatÄ±ldÄ± mesajÄ± alÄ±ndÄ±.");
            document.getElementById("meetingStatus").innerText = "ToplantÄ± baÅŸladÄ±!";
        });
        
        socket.on("meetingEnded", () => {
            document.getElementById("meetingStatus").innerText = "ToplantÄ± bitti!";
        });

        socket.on("attendanceStarted", () => {
            console.log("Yoklama baÅŸlatÄ±ldÄ± mesajÄ± alÄ±ndÄ±.");
            document.getElementById("attendanceStatus").innerText = "Yoklama baÅŸladÄ±!";
        });

        socket.on("attendanceEnded", () => {
            document.getElementById("attendanceStatus").innerText = "Yoklama bitti!";
        });

        socket.on("votingEnded", () => {
            document.getElementById("votingStatus").innerText = "Oylama bitti!";
        });
    
        socket.on("votingStarted", () => {
            console.log("Oylama baÅŸlatÄ±ldÄ± mesajÄ± alÄ±ndÄ±.");
            document.getElementById("votingStatus").innerText = "Oylama baÅŸladÄ±!";
        });

        socket.on("newRequest", (username) => {
            const requestDiv = document.getElementById("requests");
            const item = document.createElement("div");
            item.innerHTML = `${username.username} sÃ¶z istiyor 
            <button onclick="approveRequest(this, '${username.username}')">Onayla</button>`;
            requestDiv.appendChild(item);
        });

        socket.on("voteResult", ({ username, choice }) => {
            const voteDiv = document.getElementById("votes");
            let existingItem = document.getElementById(`vote-${username}`);
        
            if (existingItem) {
                // KullanÄ±cÄ± zaten listede varsa, sadece oyunu gÃ¼ncelle
                existingItem.innerText = `${username}: ${choice}`;
            } else {
                // Yeni kullanÄ±cÄ±ysa yeni satÄ±r oluÅŸtur
                const item = document.createElement("div");
                item.id = `vote-${username}`; // Her kullanÄ±cÄ±ya Ã¶zel ID
                item.innerText = `${username}: ${choice}`;
                voteDiv.appendChild(item);
            }
        });

        socket.on("updatedRequests", (requestList) => {
            const requestDiv = document.getElementById("requests");
            requestDiv.innerHTML = ""; // TÃ¼m sÃ¶z isteklerini kaldÄ±r
        
            requestList.forEach((username) => {
                const item = document.createElement("div");
                item.innerHTML = `${username} sÃ¶z istiyor 
                <button onclick="approveRequest(this, '${username}')">Onayla</button>`;
                requestDiv.appendChild(item);
            });
        });

        socket.on("updatedAttendance", (attendanceList) => {
            const attendanceDiv = document.getElementById("attendees");
            attendanceDiv.innerHTML = ""; // Listeyi temizle
        
            attendanceList.forEach((username) => {
                const item = document.createElement("div");
                item.innerText = `${username} yoklamaya katÄ±ldÄ±`;
                attendanceDiv.appendChild(item);
            });
        });

        socket.on("updatedVotes", (voteList) => {
            const voteDiv = document.getElementById("votes");
            voteDiv.innerHTML = ""; // Listeyi temizle
        
            voteList.forEach((voteData) => {
                const item = document.createElement("div");
                item.innerText = `${voteData.username}: ${voteData.choice}`;
                voteDiv.appendChild(item);
            });
        });

        socket.on("attendanceMarked", (username) => {
            const attendeeDiv = document.getElementById("attendees");
            const item = document.createElement("div");
            item.innerText = `${username.username} yoklamaya katÄ±ldÄ±`;
            attendeeDiv.appendChild(item);
        });

        socket.on("updateVoteCounts", ({ accept, reject }) => {
            document.getElementById("acceptCount").innerText = accept;
            document.getElementById("rejectCount").innerText = reject;
        });

        socket.on("updateAttendanceCount", (count) => {
            document.getElementById("attendanceCount").innerText = count;
        });

        if (!localStorage.getItem("username")) {
            window.location.href = "login.html";
        }
        function logout() {
            localStorage.removeItem("username");
            window.location.href = "login.html";
        }
    </script>
</body>
</html>